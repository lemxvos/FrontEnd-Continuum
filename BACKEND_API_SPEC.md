# ðŸ“¡ Backend API Requirements

## Dashboard Metrics Endpoints

### 1. GET /api/metrics/dashboard
**Purpose**: Get overview statistics for dashboard

**Request**: No parameters  
**Response**:
```json
{
  "totalNotes": 142,
  "totalEntities": 28,
  "uniquePeople": 15,
  "uniqueHabits": 5,
  "uniqueProjects": 3,
  "thisWeekNotes": 22,
  "thisMonthNotes": 45,
  "averageNotesPerDay": 2.1,
  "mostMentionedEntity": {
    "id": "ent_123abc",
    "name": "Work Project Alpha",
    "type": "PROJECT",
    "count": 34
  },
  "recentEntities": [\n    {\n      "id": "ent_456def",\n      "name": "John Doe",\n      "type": "PERSON",\n      "mentions": 12\n    },\n    {\n      "id": "ent_789ghi",\n      "name": "Morning Run",\n      "type": "HABIT",\n      "mentions": 18\n    }\n  ]\n}\n```\n\n**Backend Logic**:\n- Count all notes for user (totalNotes)\n- Count all unique entities mentioned across notes\n- Count by type (PERSON, HABIT, PROJECT, etc)\n- Filter notes from last 7 days (thisWeekNotes)\n- Filter notes from last 30 days (thisMonthNotes)\n- Average = totalNotes / days since account creation\n- Most mentioned = entity with highest reference count\n- Recent = sort by last mention date, limit 5\n\n---\n\n### 2. GET /api/metrics/network\n**Purpose**: Get network graph data for all entities\n\n**Query Params**:\n- `limit?`: max nodes to return (default: 50)\n- `minStrength?`: minimum connection strength (0-1, default: 0.3)\n\n**Response**:\n```json\n{\n  \"nodes\": [\n    { \"id\": \"ent_123\", \"name\": \"John\", \"type\": \"PERSON\" },\n    { \"id\": \"ent_456\", \"name\": \"Work\", \"type\": \"PROJECT\" },\n    { \"id\": \"ent_789\", \"name\": \"Exercise\", \"type\": \"HABIT\" }\n  ],\n  \"connections\": [\n    { \"source\": \"ent_123\", \"target\": \"ent_456\", \"strength\": 0.85 },\n    { \"source\": \"ent_123\", \"target\": \"ent_789\", \"strength\": 0.62 },\n    { \"source\": \"ent_456\", \"target\": \"ent_789\", \"strength\": 0.45 }\n  ]\n}\n```\n\n**Backend Logic**:\n- Nodes: All entities user has created\n- Connections: Co-occurrence relationships\n  - Strength = count of notes mentioning both / max possible\n  - Min strength filter to reduce clutter\n  - Sort by strength descending, limit by `limit` param\n\n---\n\n### 3. GET /api/metrics/network/:entityId\n**Purpose**: Get network focused on specific entity and related items\n\n**Response**: Same format as `/api/metrics/network` but:\n- Nodes filtered to: entity + all connected entities\n- Connections filtered to: edges involving main entity\n- Sorted by strength descending\n\n---\n\n### 4. GET /api/metrics/insights\n**Purpose**: Get AI-generated insights and recommendations\n\n**Response**:\n```json\n{\n  \"recentInsights\": [\n    {\n      \"title\": \"Burst in activity\",\n      \"description\": \"You created 8 notes this week, 60% more than your weekly average\",\n      \"type\": \"success\"\n    },\n    {\n      \"title\": \"New entity emerging\",\n      \"description\": \"You've mentioned 'Project Beta' 5 times in the last 3 days\",\n      \"type\": \"info\"\n    }\n  ],\n  \"recommendations\": [\n    {\n      \"title\": \"Connect related entities\",\n      \"description\": \"'John' and 'Work Project' are mentioned together frequently but not connected\",\n      \"action\": { \"label\": \"Connect\", \"path\": \"/connections\" },\n      \"type\": \"tip\"\n    },\n    {\n      \"title\": \"Review morning habits\",\n      \"description\": \"You haven't recorded exercise habit in 5 days\",\n      \"action\": { \"label\": \"Log now\", \"path\": \"/journal/new\" },\n      \"type\": \"warning\"\n    }\n  ],\n  \"patterns\": [\n    {\n      \"title\": \"Most productive on Thursdays\",\n      \"description\": \"67% of your notes are created on Thursdays\"\n    },\n    {\n      \"title\": \"Work-life balance\",\n      \"description\": \"You mention 'Work' in 40% of notes, 'Health' in 35%\"\n    }\n  ]\n}\n```\n\n**Backend Logic**:\n- Analyze user's activity patterns\n- Compare against weekly/monthly averages\n- Detect missing habits (last N days)\n- Find connected entities that aren't yet linked\n- Identify temporal patterns (day of week, time of day)\n- Generate natural language insights\n\n---\n\n### 5. GET /api/entities/:id/network\n**Purpose**: Network focused on single entity (alternative to /api/metrics/network/:entityId)\n\n**Same as**: `/api/metrics/network/:entityId`\n\n---\n\n## Related Endpoints (Already Required)\n\n### GET /api/notes/folders\n**For**: FolderTree component in Journal\n**Returns**:\n```json\n[\n  { \"path\": \"vida\", \"name\": \"Vida\", \"count\": 42 },\n  { \"path\": \"vida/amigos\", \"name\": \"Amigos\", \"count\": 15 },\n  { \"path\": \"vida/amigos/2026-02\", \"name\": \"Fevereiro 2026\", \"count\": 8 }\n]\n```\n\n### GET /api/entities/:id/related\n**For**: RelatedEntities component in EntityDetail\n**Returns**:\n```json\n[\n  {\n    \"id\": \"ent_456\",\n    \"name\": \"John Doe\",\n    \"type\": \"PERSON\",\n    \"icon\": \"ðŸ‘¤\",\n    \"color\": \"blue\",\n    \"connectionStrength\": 0.87\n  }\n]\n```\n\n---\n\n## Implementation Priority\n\n1. **High Priority** (Dashboard works without):\n   - âœ… GET /api/entities/:id/related\n   - âœ… GET /api/notes/folders\n\n2. **Core Dashboard**:\n   - ðŸ”´ GET /api/metrics/dashboard (simple stats)\n   - ðŸ”´ GET /api/metrics/network (relationship graph)\n\n3. **Enhanced Experience**:\n   - ðŸŸ¡ GET /api/metrics/insights (AI insights)\n\n---\n\n## Data Requirements for Calculations\n\n### For Dashboard Stats:\n- Note creation date\n- Entity type (PERSON, HABIT, PROJECT, etc)\n- Entity mentions in notes (count)\n\n### For Network:\n- Entity co-occurrence: which entities appear in same notes\n- Connection count: how many times entities co-occur\n\n### For Insights:\n- Weekly activity trends\n- Daily breakdown of activity\n- Habit tracking (last recorded date)\n- New entities created (date)\n- Entity mention frequency over time\n\n---\n\n## Caching Recommendations\n\n**Cache Duration**:\n- Dashboard stats: 1 hour (changes frequently)\n- Network graph: 4 hours (heavy computation)\n- Insights: 24 hours (weekly trends)\n\n**Cache Keys**:\n- `dashboard:user_id:${userId}`\n- `network:user_id:${userId}:${limit}:${minStrength}`\n- `insights:user_id:${userId}`\n\n---\n\n## Performance Considerations\n\n**For Large Users (1000+ notes)**:\n- Paginate network nodes (load initial set, lazy load more)\n- Implement co-occurrence indexing (pre-calculated)\n- Cache insights at user level\n- Consider separate analytics backend\n\n**Database Queries**:\n- Count queries should use SELECT COUNT(DISTINCT entity_id)\n- Co-occurrence queries need JOIN on note_entity table\n- Week/month filters use date ranges (indexed)\n\n---\n\n## Error Handling\n\n**Expected Errors**:\n```\n401 Unauthorized - User not authenticated\n404 Not Found - Entity/User not found\n500 Internal Server Error - Calculation failure\n```\n\n**Client Handling**:\n- All Dashboard components have try/catch + toast.error()\n- Skeleton loaders show while data loads\n- Empty states when no data available\n