# CONTINUUM FRONTEND HANDBOOK\n\n**DÃºvidas?** Comece aqui! ğŸš€\n\n---\n\n## 1ï¸âƒ£ MENÃ‡Ã•ES - TUDO QUE PRECISA SABER\n\n### O QUE Ã‰ UMA MENÃ‡ÃƒO?\n\nUma menÃ§Ã£o Ã© uma **referÃªncia a uma entidade** dentro de uma nota.\n\n**Formato obrigatÃ³rio:**\n```\n{type:id}\n```\n\n**Exemplos vÃ¡lidos:**\n```\n{person:ent_8f2a}\n{project:ent_91ab}\n{habit:ent_1234}\n{custom:ent_xyz}\n```\n\n### O FRONTEND FAZA COM MENÃ‡Ã•ES?\n\nâœ… **FAZER:**\n- Insere `{type:id}` quando usuÃ¡rio seleciona entidade\n- Exibe em preview com badges coloridas\n- Envia content com menÃ§Ãµes para backend\n- Recebe entities jÃ¡ processadas\n- Renderiza com MentionDisplay\n\nâŒ **NÃƒO FAZER:**\n- Validar se existe\n- Validar se type Ã© correto\n- Contar menÃ§Ãµes (para significado)\n- Buscar a entidade\n- Atualizar Ã­ndices\n\n### FLUXO PRÃTICO\n\n**ANTES** (usuÃ¡rio digitando):\n```\nTextarea: \"SaÃ­ com {pe\"\n```\n\n**O frontend detecta:**\n```javascript\nuseMentionAutocompleteState(\"SaÃ­ com {pe\", 12)\n// Retorna: { trigger: \"{\", query: \"pe\", position: 8 }\n```\n\n**Frontend mostra dropdown:**\n```tsx\n<EntitySelector \n  initialQuery=\"pe\"\n  onSelect={(entity) => insertMention(entity)}\n/>\n```\n\n**UsuÃ¡rio clica em \"Pessoa X\":**\n```javascript\nhandleEntitySelect({\n  id: \"ent_8f2a\",\n  type: \"person\",\n  name: \"Pessoa X\"\n})\n```\n\n**Frontend insere:**\n```\nTextarea: \"SaÃ­ com {person:ent_8f2a}\"\n```\n\n**DEPOIS** (ao salvar):\n```json\n{\n  \"title\": \"...\",\n  \"content\": \"SaÃ­ com {person:ent_8f2a}\",\n  \"folderPath\": \"vida/amigos\"\n}\n```\nâ†“ **BACKEND PROCESSA** (NÃƒO FRONTEND!)\nâ†“ Parseia, valida, busca entidade, atualiza Ã­ndice\nâ†“ **RETORNA**:\n```json\n{\n  \"id\": \"note_abc\",\n  \"content\": \"SaÃ­ com {person:ent_8f2a}\",\n  \"entities\": [\n    {\n      \"id\": \"ent_8f2a\",\n      \"type\": \"person\",\n      \"name\": \"Pessoa X\",\n      \"icon\": \"ğŸ‘©\",\n      \"color\": \"#ec4899\"\n    }\n  ]\n}\n```\n\n**Frontend renderiza:**\n```\nSaÃ­ com [ğŸ‘© Pessoa X]\n```\n\n---\n\n## 2ï¸âƒ£ TIPOS DE ENTIDADES\n\n```typescript\ntype EntityType = \n  | \"person\"    // Pessoas\n  | \"project\"   // Projetos\n  | \"habit\"     // HÃ¡bitos  \n  | \"goal\"      // Objetivos\n  | \"dream\"     // Sonhos\n  | \"event\"     // Eventos\n  | \"custom\"    // Custom\n```\n\n**Exemplo completo:**\n```json\n{\n  \"id\": \"ent_8f2a\",\n  \"type\": \"person\",\n  \"name\": \"Emilly\",\n  \"icon\": \"ğŸ‘©\",\n  \"color\": \"#ec4899\",\n  \"description\": \"Melhor amiga desde 2015\",\n  \"createdAt\": \"2026-01-15T10:00:00Z\",\n  \"updatedAt\": \"2026-02-18T10:00:00Z\"\n}\n```\n\n---\n\n## 3ï¸âƒ£ ESTRUTURA DE UMA NOTA\n\n```json\n{\n  \"id\": \"note_abc123\",\n  \"title\": \"SÃ¡bado com amigos\",\n  \"content\": \"SaÃ­ com {person:ent_8f2a} e {person:ent_91cd} em {project:ent_xyz}\",\n  \"folderPath\": \"vida/social/2026-02\",\n  \n  \"entities\": [\n    { \"id\": \"ent_8f2a\", \"type\": \"person\", \"name\": \"Emilly\", ... },\n    { \"id\": \"ent_91cd\", \"type\": \"person\", \"name\": \"Sofia\", ... },\n    { \"id\": \"ent_xyz\", \"type\": \"project\", \"name\": \"CafÃ© Noir\", ... }\n  ],\n  \n  \"createdAt\": \"2026-02-15T14:30:00Z\",\n  \"updatedAt\": \"2026-02-18T10:00:00Z\"\n}\n```\n\n### CAMPOS\n\n| Campo | Type | Origem | Frontend Pode Editar? |\n|-------|------|--------|----------------------|\n| `id` | string | Backend | âŒ NÃ£o |\n| `title` | string | User | âœ… Sim |\n| `content` | string | User | âœ… Sim |\n| `folderPath` | string | User | âœ… Sim |\n| `entities` | Entity[] | **Backend** | âŒ NÃ£o (backend calcula) |\n| `createdAt` | ISO | Backend | âŒ NÃ£o |\n| `updatedAt` | ISO | Backend | âŒ NÃ£o |\n\n---\n\n## 4ï¸âƒ£ FLUXO: CRIAR NOTA\n\n```\nâ”Œâ”€ USUÃRIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Clica em \"+ Nova Nota\"    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ FRONTEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ <JournalEditor noteId={undefined} />          â”‚\nâ”‚ â†’ Abre editor novo                             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ USER EDITA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Title: \"SÃ¡bado\"           â”‚\nâ”‚ Content: \"SaÃ­ com {pe...\" â”‚\nâ”‚ Folder: \"vida/social\"     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ AUTOCOMPLETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Detecta {pe              â”‚\nâ”‚ Mostra dropdown          â”‚\nâ”‚ User seleciona \"Pessoa X\"â”‚\nâ”‚ â†’ {person:ent_8f2a}      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ PREVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ \"SaÃ­ com [ğŸ‘© Pessoa X]\"   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ USER CLICA SALVAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ noteStore.create({                   â”‚\nâ”‚   title: \"SÃ¡bado\",                   â”‚\nâ”‚   content: \"SaÃ­ com {person:ent_8f2a}\", â”‚\nâ”‚   folderPath: \"vida/social\"          â”‚\nâ”‚ })                                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ FRONTEND SERVICE â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ noteService.create(...)   â”‚\nâ”‚ POST /api/notes           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ•”â•BACKENDâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘ 1. Recebe content com menciones             â•‘\nâ•‘ 2. Parseia {person:ent_8f2a}                â•‘\nâ•‘ 3. Valida se existe                         â•‘\nâ•‘ 4. Busca entity                             â•‘\nâ•‘ 5. Atualiza Ã­ndice                          â•‘\nâ•‘ 6. Processa pastas                          â•‘\nâ•‘ 7. Retorna Note com entities[]              â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n               â†“\nâ”Œâ”€ FRONTEND RECEBE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ {                          â”‚\nâ”‚   id: \"note_abc\",          â”‚\nâ”‚   content: \"SaÃ­ com {person:ent_8f2a}\", â”‚\nâ”‚   entities: [{...}],       â”‚\nâ”‚   createdAt: \"...\",        â”‚\nâ”‚   updatedAt: \"...\"         â”‚\nâ”‚ }                          â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ STORE SINCRONIZA â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ useNoteStore.create()     â”‚\nâ”‚ â†’ Adiciona ao cache       â”‚\nâ”‚ â†’ noteStore.notes += [new]â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ UI RE-RENDERIZA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Lista de notas atualiza   â”‚\nâ”‚ MentionDisplay renderiza  â”‚\nâ”‚ [ğŸ‘© Pessoa X] com badge   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## 5ï¸âƒ£ FLUXO: EDITAR NOTA\n\n```\nMesmo que CREATE, pero:\n\n1. JournalEditor com noteId\n2. useNoteStore.fetchOne(noteId)\n3. Carrega conteÃºdo existente\n4. User modifica\n5. noteStore.update(noteId, {...})\n6. PUT /api/notes/:id\n\nBACKEND RECALCULA TUDO:\n- Remove entidades antigas do Ã­ndice\n- Parseia novo content\n- Busca entidades novas\n- Atualiza Ã­ndice\n- Retorna atualizado\n```\n\n---\n\n## 6ï¸âƒ£ FLUXO: AUTOCOMPLETE\n\n```\nâ”Œâ”€ USER DIGITA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ \"SaÃ­ com {pe               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ FRONTEND DETECTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ useMentionAutocompleteState()       â”‚\nâ”‚ â†’ { trigger: \"{\", query: \"pe\" }    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ FRONTEND BUSCA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ useEntityStore.search(\"pe\")        â”‚\nâ”‚ entityService.autocomplete(\"pe\")   â”‚\nâ”‚ GET /api/entities/search?q=pe     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ BACKEND RETORNA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ [                                  â”‚\nâ”‚   { id: \"ent_8f2a\", name: \"Pessoa X\" },  â”‚\nâ”‚   { id: \"ent_xyz\", name: \"Projeto Y\" }   â”‚\nâ”‚ ]                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ STORE SINCRONIZA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ useEntityStore.lastSearchResults[] â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ DROPDOWN RENDERIZA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ [ğŸ‘© Pessoa X]                      â”‚\nâ”‚ [ğŸ“Š Projeto Y]                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n               â†“\nâ”Œâ”€ USER CLICA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ handleEntitySelect(entity)         â”‚\nâ”‚ â†’ insertMentionAtPosition(...)     â”‚\nâ”‚ â†’ content += \"{person:ent_xyz}\"     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## 7ï¸âƒ£ SLOTS E RESPONSABILIDADES\n\n### Frontend SÃ³ Deve TAO:\n\n```typescript\n// âœ… PERMITIDO\ndisplay(entity)                        // Mostrar dados\nformat(mention, type, id)              // Formatar menÃ§Ã£o\ninsert(mention, atPosition)            // Inserir no editor\nrender(content, entities)              // Renderizar com badges\ncache(data)                            // Guardar em Zustand\nsend(payload)                          // Enviar ao backend\nhandle(error)                          // Exibir erro\n\n// âŒ PROIBIDO\nparse(content)                         // Identify meaning\nvalidate(mention)                      // Check if valid\ncount(mentions)                        // Count for indexing\nindex(mention)                         // Update indices\ncalculate(relevance)                   // Calculate meaning\ndelete(orphan)                         // Cleanup logic\nresolve(conflict)                      // Handle semantic conflicts\n```\n\n---\n\n## 8ï¸âƒ£ TRATAMENTO DE ERROS\n\n### Erro 404: Entity Not Found\n\n```json\nResponse:\n{\n  \"error\": \"Entity not found: ent_xyz\",\n  \"code\": \"ENTITY_NOT_FOUND\"\n}\n```\n\n**Frontend deve:**\n```tsx\nif (error.code === \"ENTITY_NOT_FOUND\") {\n  alert(\"A entidade nÃ£o existe\");\n  // NÃ£o tenta corrigir, nÃ£o tenta criar\n}\n```\n\n### Erro 400: Entity Type Mismatch\n\n```json\nResponse:\n{\n  \"error\": \"Type 'person' does not match entity 'ent_xyz' which is type 'project'\",\n  \"code\": \"TYPE_MISMATCH\"\n}\n```\n\n**Frontend deve:**\n```tsx\nif (error.code === \"TYPE_MISMATCH\") {\n  alert(\"Tipo de entidade incorreto\");\n  // NÃ£o tenta adivinhar, nÃ£o tenta corrigir\n}\n```\n\n### Erro 403: Limit Reached\n\n```json\nResponse:\n{\n  \"error\": \"Entity limit reached for plan FREE\",\n  \"code\": \"LIMIT_REACHED\"\n}\n```\n\n**Frontend deve:**\n```tsx\nif (error.code === \"LIMIT_REACHED\") {\n  // Mostra upgrade modal\n  showUpgradeModal();\n}\n```\n\n---\n\n## 9ï¸âƒ£ BOAS PRÃTICAS\n\n### âœ… FAZER\n\n```typescript\n// 1. Usar stores como fonte de verdade\nconst notes = useNoteStore((s) => s.notes);\n\n// 2. Despachar aÃ§Ãµes no store\nconst { create } = useNoteStore();\nawait create(payload);\n\n// 3. Renderizar dados jÃ¡ processados\n<MentionDisplay content={note.content} entities={note.entities} />\n\n// 4. Exibir erros claros\ncatch(error) {\n  setError(error.message);\n}\n\n// 5. Usar Zustand para cache\nconst entities = useEntityStore((s) => s.entities);\n\n// 6. Confiar em dados do backend\nconst entityCount = note.entities.length; // âœ… OK\n```\n\n### âŒ NÃƒO FAZER\n\n```typescript\n// 1. Tentar parsear menÃ§Ãµes\nconst matches = content.match(/\\{([^:]+):([^}]+)\\}/);\n// âŒ Apenas tokeniza se for DISPLAY, nÃ£o parsing!\n\n// 2. Validar entidades localmente\nif (!entities.find(e => e.id === refId)) {\n  return error; // âŒ Backend valida!\n}\n\n// 3. Calcular Ã­ndices\nconst index = entities.map((e) => ({ id: e.id, count: ... }));\n// âŒ Backend calcula!\n\n// 4. Transformar dados\nconst processed = processBackendResponse(data);\n// âŒ Apenas exiba como recebeu!\n\n// 5. Duplicar lÃ³gica de backend\nfunction validateEntityType(type, id) {\n  // âŒ Backend faz isso!\n}\n\n// 6. State fora do store\nconst [entities, setEntities] = useState([]);\n// âŒ Use Zustand/store!\n```\n\n---\n\n## ğŸ”Ÿ DEBUGGING\n\n### Verificar store state\n\n```typescript\n// DevTools Zustand\nimport { useNoteStore } from '@/stores/noteStore';\n\nconst state = useNoteStore((s) => s);\nconsole.log('Note Store:', state);\n```\n\n### Verificar menÃ§Ã£o sendo detectada\n\n```typescript\nconst state = useMentionAutocompleteState(text, cursorPos);\nconsole.log('Autocomplete State:', state);\n```\n\n### Verificar service call\n\n```typescript\nconst response = await noteService.create(payload);\nconsole.log('Response:', response);\n```\n\n---\n\n## ğŸ“‹ CHECKLIST PARA NOVA FEATURE\n\n- [ ] Defini no `types/models.ts`?\n- [ ] Criei no `services/`?\n- [ ] Adicionei action no `stores/`?\n- [ ] Criei componente em `components/`?\n- [ ] Usei `useStore()` como fonte?\n- [ ] Handlei erros?\n- [ ] Adicionei loading state?\n- [ ] Testti com backend real?\n- [ ] Documentei behaviour?\n- [ ] Revisei with tech lead?\n\n---\n\n## ğŸ“ REGRA FINAL\n\n> Quando em dÃºvida:\n>\n> 1. **Parsing/ValidaÃ§Ã£o/CÃ¡lculo?** â†’ Backend\n> 2. **RenderizaÃ§Ã£o/Display/UX?** â†’ Frontend\n> 3. **SincronizaÃ§Ã£o?** â†’ Zustand Store\n> 4. **HTTP?** â†’ Service â†’ Store â†’ Component\n> 5. **Erro?** â†’ Exiba, nÃ£o corrija\n\n---\n\n**Pronto para comeÃ§ar? Abra [INTEGRATION_EXAMPLES.tsx](./INTEGRATION_EXAMPLES.tsx)!**\n"